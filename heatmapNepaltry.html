<html>

<head>
<style type="text/css">
.inline {
  background-color: #f7f7f7;
  border:solid 1px #B0B0B0;
}
.error {
	font-weight: bold;
	color: #FF0000;
}
.warning {
	font-weight: bold;
}
.message {
	font-style: italic;
}
.source, .output, .warning, .error, .message {
	padding: 0 1em;
  border:solid 1px #F7F7F7;
}
.source {
  background-color: #f5f5f5;
}
.left {
  text-align: left;
}
.right {
  text-align: right;
}
.center {
  text-align: center;
}
.hl.num {
  color: #AF0F91;
}
.hl.str {
  color: #317ECC;
}
.hl.com {
  color: #AD95AF;
  font-style: italic;
}
.hl.opt {
  color: #000000;
}
.hl.std {
  color: #585858;
}
.hl.kwa {
  color: #295F94;
  font-weight: bold;
}
.hl.kwb {
  color: #B05A65;
}
.hl.kwc {
  color: #55aa55;
}
.hl.kwd {
  color: #BC5A65;
  font-weight: bold;
}
</style>
<title>Title</title>
</head>

<body>

<p>This is an R HTML document. When you click the <b>Knit HTML</b> button a web page will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:</p>

<div class="chunk" id="unnamed-chunk-1"><div class="rcode"><div class="source"><pre class="knitr r"><span class="hl com"># follow the following website</span>
<span class="hl com"># https://medium.com/@anjesh/step-by-step-choropleth-map-in-r-a-case-of-mapping-nepal-7f62a84078d9</span>

<span class="hl kwd">install.packages</span><span class="hl std">(</span><span class="hl str">&quot;rgdal&quot;</span><span class="hl std">)</span>
</pre></div>
<div class="error"><pre class="knitr r">## Error in contrib.url(repos, &quot;source&quot;): trying to use CRAN without setting a mirror
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl kwd">install.packages</span><span class="hl std">(</span><span class="hl str">&quot;gpclib&quot;</span><span class="hl std">)</span>
</pre></div>
<div class="error"><pre class="knitr r">## Error in contrib.url(repos, &quot;source&quot;): trying to use CRAN without setting a mirror
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl kwd">install.packages</span><span class="hl std">(</span><span class="hl str">&quot;maptool&quot;</span><span class="hl std">)</span>
</pre></div>
<div class="error"><pre class="knitr r">## Error in contrib.url(repos, &quot;source&quot;): trying to use CRAN without setting a mirror
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl kwd">library</span><span class="hl std">(rgdal)</span>
</pre></div>
<div class="warning"><pre class="knitr r">## Warning: package 'rgdal' was built under R version 3.5.2
</pre></div>
<div class="message"><pre class="knitr r">## Loading required package: sp
</pre></div>
<div class="message"><pre class="knitr r">## rgdal: version: 1.4-8, (SVN revision 845)
##  Geospatial Data Abstraction Library extensions to R successfully loaded
##  Loaded GDAL runtime: GDAL 2.4.2, released 2019/06/28
##  Path to GDAL shared files: /Library/Frameworks/R.framework/Versions/3.5/Resources/library/rgdal/gdal
##  GDAL binary built with GEOS: FALSE 
##  Loaded PROJ.4 runtime: Rel. 5.2.0, September 15th, 2018, [PJ_VERSION: 520]
##  Path to PROJ.4 shared files: /Library/Frameworks/R.framework/Versions/3.5/Resources/library/rgdal/proj
##  Linking to sp version: 1.3-2
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl kwd">library</span><span class="hl std">(ggplot2)</span>
<span class="hl kwd">library</span><span class="hl std">(dplyr)</span>
</pre></div>
<div class="message"><pre class="knitr r">## 
## Attaching package: 'dplyr'
</pre></div>
<div class="message"><pre class="knitr r">## The following objects are masked from 'package:stats':
## 
##     filter, lag
</pre></div>
<div class="message"><pre class="knitr r">## The following objects are masked from 'package:base':
## 
##     intersect, setdiff, setequal, union
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl kwd">library</span><span class="hl std">(gpclib)</span>
</pre></div>
<div class="warning"><pre class="knitr r">## Warning: package 'gpclib' was built under R version 3.5.2
</pre></div>
<div class="message"><pre class="knitr r">## General Polygon Clipper Library for R (version 1.5-6)
## 	Type 'class ? gpc.poly' for help
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl kwd">gpclibPermit</span><span class="hl std">()</span>
</pre></div>
<div class="error"><pre class="knitr r">## Error in gpclibPermit(): could not find function &quot;gpclibPermit&quot;
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl kwd">library</span><span class="hl std">(maptools)</span>
</pre></div>
<div class="message"><pre class="knitr r">## Checking rgeos availability: FALSE
##  	Note: when rgeos is not available, polygon geometry 	computations in maptools depend on gpclib,
##  	which has a restricted licence. It is disabled by default;
##  	to enable gpclib, type gpclibPermit()
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl std">nepal.adm3.shp</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">readOGR</span><span class="hl std">(</span><span class="hl kwc">dsn</span><span class="hl std">=</span><span class="hl str">&quot;/Users/bibhadhungel/Desktop/webpage/NepalMaps/baselayers/NPL_adm&quot;</span><span class="hl std">,</span> <span class="hl kwc">layer</span><span class="hl std">=</span><span class="hl str">&quot;NPL_adm3&quot;</span><span class="hl std">,</span> <span class="hl kwc">stringsAsFactors</span> <span class="hl std">=</span> <span class="hl num">FALSE</span><span class="hl std">)</span>
</pre></div>
<div class="output"><pre class="knitr r">## OGR data source with driver: ESRI Shapefile 
## Source: &quot;/Users/bibhadhungel/Desktop/webpage/NepalMaps/baselayers/NPL_adm&quot;, layer: &quot;NPL_adm3&quot;
## with 75 features
## It has 13 fields
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl std">nepal.adm3.shp.df</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">fortify</span><span class="hl std">(nepal.adm3.shp,</span> <span class="hl kwc">region</span> <span class="hl std">=</span> <span class="hl str">&quot;NAME_3&quot;</span><span class="hl std">)</span>
</pre></div>
<div class="error"><pre class="knitr r">## Error in maptools::unionSpatialPolygons(cp, attr[, region]): isTRUE(gpclibPermitStatus()) is not TRUE
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl std">map</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">ggplot</span><span class="hl std">(</span><span class="hl kwc">data</span> <span class="hl std">= nepal.adm3.shp.df,</span> <span class="hl kwd">aes</span><span class="hl std">(</span><span class="hl kwc">x</span> <span class="hl std">= long,</span> <span class="hl kwc">y</span> <span class="hl std">= lat,</span> <span class="hl kwc">group</span> <span class="hl std">= group))</span>
</pre></div>
<div class="error"><pre class="knitr r">## Error in ggplot(data = nepal.adm3.shp.df, aes(x = long, y = lat, group = group)): object 'nepal.adm3.shp.df' not found
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl std">map</span> <span class="hl opt">+</span> <span class="hl kwd">geom_path</span><span class="hl std">()</span>
</pre></div>
<div class="error"><pre class="knitr r">## Error in eval(expr, envir, enclos): object 'map' not found
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl std">map</span> <span class="hl opt">+</span>
  <span class="hl kwd">geom_polygon</span><span class="hl std">(</span><span class="hl kwd">aes</span><span class="hl std">(</span><span class="hl kwc">fill</span> <span class="hl std">= id))</span> <span class="hl opt">+</span>
  <span class="hl kwd">coord_fixed</span><span class="hl std">(</span><span class="hl num">1.3</span><span class="hl std">)</span> <span class="hl opt">+</span>
  <span class="hl kwd">guides</span><span class="hl std">(</span><span class="hl kwc">fill</span> <span class="hl std">=</span> <span class="hl num">FALSE</span><span class="hl std">)</span>
</pre></div>
<div class="error"><pre class="knitr r">## Error in eval(expr, envir, enclos): object 'map' not found
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl std">nepal.adm3.shp.df</span> <span class="hl opt">%&gt;%</span>
  <span class="hl kwd">distinct</span><span class="hl std">(id)</span> <span class="hl opt">%&gt;%</span>
  <span class="hl kwd">write.csv</span><span class="hl std">(</span><span class="hl str">&quot;/Users/bibhadhungel/Desktop/webpage/NepalMaps/baselayers/districts12.csv&quot;</span><span class="hl std">,</span> <span class="hl kwc">row.names</span> <span class="hl std">=</span> <span class="hl num">FALSE</span><span class="hl std">)</span>
</pre></div>
<div class="error"><pre class="knitr r">## Error in eval(lhs, parent, parent): object 'nepal.adm3.shp.df' not found
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl std">nepal.adm3.shp.df</span> <span class="hl opt">%&gt;%</span>
  <span class="hl kwd">distinct</span><span class="hl std">(id)</span> <span class="hl opt">%&gt;%</span>
  <span class="hl kwd">write.csv</span><span class="hl std">(</span><span class="hl str">&quot;districts.csv&quot;</span><span class="hl std">,</span> <span class="hl kwc">row.names</span> <span class="hl std">=</span> <span class="hl num">FALSE</span><span class="hl std">)</span>
</pre></div>
<div class="error"><pre class="knitr r">## Error in eval(lhs, parent, parent): object 'nepal.adm3.shp.df' not found
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl std">hpi.data</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">read.csv</span><span class="hl std">(</span><span class="hl str">&quot;districts.csv&quot;</span><span class="hl std">)</span>
<span class="hl kwd">colnames</span><span class="hl std">(hpi.data)</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">c</span><span class="hl std">(</span><span class="hl str">&quot;id&quot;</span><span class="hl std">)</span>

<span class="hl std">hpi.data</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">read.csv</span><span class="hl std">(</span><span class="hl str">&quot;/Users/bibhadhungel/Desktop/webpage/NepalMaps/baselayers/corona.csv&quot;</span><span class="hl std">)</span>
<span class="hl com">#hpi.data &lt;- read.csv(&quot;/Users/bibhadhungel/Desktop/webpage/NepalMaps/data.csv.txt&quot;)</span>
<span class="hl com">#hpi.data</span>
<span class="hl com">#colnames(hpi.data) &lt;- c(&quot;id&quot;,&quot;A&quot;,&quot;B&quot;,&quot;C&quot;,&quot;D&quot;,&quot;HPI&quot;)</span>


<span class="hl std">nepal.adm3.shp.df</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">merge</span><span class="hl std">(nepal.adm3.shp.df, hpi.data,</span> <span class="hl kwc">by</span> <span class="hl std">=</span><span class="hl str">&quot;id&quot;</span><span class="hl std">)</span>
</pre></div>
<div class="error"><pre class="knitr r">## Error in merge(nepal.adm3.shp.df, hpi.data, by = &quot;id&quot;): object 'nepal.adm3.shp.df' not found
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl com"># Drawing Choropleth map</span>
<span class="hl com">#Since dataframe nepal.adm3.shp.df is now updated (with extra HPI column), lets re-create the map plot variable again.</span>

<span class="hl std">map</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">ggplot</span><span class="hl std">(</span><span class="hl kwc">data</span> <span class="hl std">= nepal.adm3.shp.df,</span> <span class="hl kwd">aes</span><span class="hl std">(</span><span class="hl kwc">x</span> <span class="hl std">= long,</span> <span class="hl kwc">y</span> <span class="hl std">= lat,</span> <span class="hl kwc">group</span> <span class="hl std">= group))</span>
</pre></div>
<div class="error"><pre class="knitr r">## Error in ggplot(data = nepal.adm3.shp.df, aes(x = long, y = lat, group = group)): object 'nepal.adm3.shp.df' not found
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl com"># Run the following code to create polygon map, using corona CASES to fill the polygons.</span>
<span class="hl std">map</span> <span class="hl opt">+</span>
  <span class="hl kwd">geom_polygon</span><span class="hl std">(</span><span class="hl kwd">aes</span><span class="hl std">(</span><span class="hl kwc">fill</span> <span class="hl std">= Cases),</span> <span class="hl kwc">color</span> <span class="hl std">=</span> <span class="hl str">'gray'</span><span class="hl std">,</span> <span class="hl kwc">size</span> <span class="hl std">=</span> <span class="hl num">0.1</span><span class="hl std">)</span> <span class="hl opt">+</span>
  <span class="hl kwd">coord_fixed</span><span class="hl std">(</span><span class="hl num">1.3</span><span class="hl std">)</span>
</pre></div>
<div class="error"><pre class="knitr r">## Error in eval(expr, envir, enclos): object 'map' not found
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl com">#However there are still issues, lets change the gradient so that the high value of HPI (40+) is represented by dark colors and low value (20-) by light colors.</span>
<span class="hl com">#Changing the gradient scale</span>
<span class="hl com">#Add scale_fill_gradient(..) and give high and low colors. Play with the colors to see how the colors are changed in the map.</span>

  <span class="hl std">map</span> <span class="hl opt">+</span>
    <span class="hl kwd">geom_polygon</span><span class="hl std">(</span><span class="hl kwd">aes</span><span class="hl std">(</span><span class="hl kwc">fill</span> <span class="hl std">= Cases),</span> <span class="hl kwc">color</span> <span class="hl std">=</span> <span class="hl str">'gray'</span><span class="hl std">,</span> <span class="hl kwc">size</span> <span class="hl std">=</span> <span class="hl num">0.1</span><span class="hl std">)</span> <span class="hl opt">+</span>
    <span class="hl kwd">scale_fill_gradient</span><span class="hl std">(</span><span class="hl kwc">high</span> <span class="hl std">=</span> <span class="hl str">&quot;#e34a33&quot;</span><span class="hl std">,</span> <span class="hl kwc">low</span> <span class="hl std">=</span> <span class="hl str">&quot;#fee8c8&quot;</span><span class="hl std">,</span> <span class="hl kwc">guide</span> <span class="hl std">=</span> <span class="hl str">&quot;colorbar&quot;</span><span class="hl std">)</span> <span class="hl opt">+</span>
    <span class="hl kwd">coord_fixed</span><span class="hl std">(</span><span class="hl num">1.3</span><span class="hl std">)</span>
</pre></div>
<div class="error"><pre class="knitr r">## Error in eval(expr, envir, enclos): object 'map' not found
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl com"># Changing Legend Title</span>
  <span class="hl com">#Now change the legend title from default to something you want.</span>

  <span class="hl std">map</span> <span class="hl opt">+</span>
    <span class="hl kwd">geom_polygon</span><span class="hl std">(</span><span class="hl kwd">aes</span><span class="hl std">(</span><span class="hl kwc">fill</span> <span class="hl std">= Cases),</span> <span class="hl kwc">color</span> <span class="hl std">=</span> <span class="hl str">'gray'</span><span class="hl std">,</span> <span class="hl kwc">size</span> <span class="hl std">=</span> <span class="hl num">0.1</span><span class="hl std">)</span> <span class="hl opt">+</span>
    <span class="hl kwd">scale_fill_gradient</span><span class="hl std">(</span><span class="hl kwc">high</span> <span class="hl std">=</span> <span class="hl str">&quot;#e34a33&quot;</span><span class="hl std">,</span> <span class="hl kwc">low</span> <span class="hl std">=</span> <span class="hl str">&quot;#fee8c8&quot;</span><span class="hl std">,</span> <span class="hl kwc">guide</span> <span class="hl std">=</span> <span class="hl str">&quot;colorbar&quot;</span><span class="hl std">)</span> <span class="hl opt">+</span>
    <span class="hl kwd">coord_fixed</span><span class="hl std">(</span><span class="hl num">1.3</span><span class="hl std">)</span> <span class="hl opt">+</span>
    <span class="hl kwd">guides</span><span class="hl std">(</span><span class="hl kwc">fill</span><span class="hl std">=</span><span class="hl kwd">guide_colorbar</span><span class="hl std">(</span><span class="hl kwc">title</span><span class="hl std">=</span><span class="hl str">&quot;Total Covid-19 cases&quot;</span><span class="hl std">))</span>
</pre></div>
<div class="error"><pre class="knitr r">## Error in eval(expr, envir, enclos): object 'map' not found
</pre></div>
<div class="source"><pre class="knitr r">  <span class="hl com">#Moving the Legend inside chart</span>
  <span class="hl com">#There’s ample space inside the chart, why don’t we move the legend inside the chart.</span>
  <span class="hl std">map</span> <span class="hl opt">+</span>
    <span class="hl kwd">geom_polygon</span><span class="hl std">(</span><span class="hl kwd">aes</span><span class="hl std">(</span><span class="hl kwc">fill</span> <span class="hl std">= Cases),</span> <span class="hl kwc">color</span> <span class="hl std">=</span> <span class="hl str">'gray'</span><span class="hl std">,</span> <span class="hl kwc">size</span> <span class="hl std">=</span> <span class="hl num">0.1</span><span class="hl std">)</span> <span class="hl opt">+</span>
    <span class="hl kwd">scale_fill_gradient</span><span class="hl std">(</span><span class="hl kwc">high</span> <span class="hl std">=</span> <span class="hl str">&quot;#e34a33&quot;</span><span class="hl std">,</span> <span class="hl kwc">low</span> <span class="hl std">=</span> <span class="hl str">&quot;#fee8c8&quot;</span><span class="hl std">,</span> <span class="hl kwc">guide</span> <span class="hl std">=</span> <span class="hl str">&quot;colorbar&quot;</span><span class="hl std">)</span> <span class="hl opt">+</span>
    <span class="hl kwd">coord_fixed</span><span class="hl std">(</span><span class="hl num">1.3</span><span class="hl std">)</span> <span class="hl opt">+</span>
    <span class="hl kwd">guides</span><span class="hl std">(</span><span class="hl kwc">fill</span><span class="hl std">=</span><span class="hl kwd">guide_colorbar</span><span class="hl std">(</span><span class="hl kwc">title</span><span class="hl std">=</span><span class="hl str">&quot;Total Covid-19 cases&quot;</span><span class="hl std">))</span> <span class="hl opt">+</span>
    <span class="hl kwd">theme</span><span class="hl std">(</span><span class="hl kwc">legend.justification</span><span class="hl std">=</span><span class="hl kwd">c</span><span class="hl std">(</span><span class="hl num">0</span><span class="hl std">,</span><span class="hl num">0</span><span class="hl std">),</span> <span class="hl kwc">legend.position</span><span class="hl std">=</span><span class="hl kwd">c</span><span class="hl std">(</span><span class="hl num">0</span><span class="hl std">,</span><span class="hl num">0</span><span class="hl std">))</span>
</pre></div>
<div class="error"><pre class="knitr r">## Error in eval(expr, envir, enclos): object 'map' not found
</pre></div>
<div class="source"><pre class="knitr r">  <span class="hl com"># Creating clean map</span>
  <span class="hl com">#The background grid and lat-long axis are not necessary for the map. Lets remove them.</span>
  <span class="hl std">theme_bare</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">theme</span><span class="hl std">(</span>
    <span class="hl kwc">axis.line</span> <span class="hl std">=</span> <span class="hl kwd">element_blank</span><span class="hl std">(),</span>
    <span class="hl kwc">axis.text.x</span> <span class="hl std">=</span> <span class="hl kwd">element_blank</span><span class="hl std">(),</span>
    <span class="hl kwc">axis.text.y</span> <span class="hl std">=</span> <span class="hl kwd">element_blank</span><span class="hl std">(),</span>
    <span class="hl kwc">axis.ticks</span> <span class="hl std">=</span> <span class="hl kwd">element_blank</span><span class="hl std">(),</span>
    <span class="hl kwc">axis.title.x</span> <span class="hl std">=</span> <span class="hl kwd">element_blank</span><span class="hl std">(),</span>
    <span class="hl kwc">axis.title.y</span> <span class="hl std">=</span> <span class="hl kwd">element_blank</span><span class="hl std">(),</span>
    <span class="hl kwc">legend.text</span><span class="hl std">=</span><span class="hl kwd">element_text</span><span class="hl std">(</span><span class="hl kwc">size</span><span class="hl std">=</span><span class="hl num">7</span><span class="hl std">),</span>
    <span class="hl kwc">legend.title</span><span class="hl std">=</span><span class="hl kwd">element_text</span><span class="hl std">(</span><span class="hl kwc">size</span><span class="hl std">=</span><span class="hl num">8</span><span class="hl std">),</span>
    <span class="hl kwc">panel.background</span> <span class="hl std">=</span> <span class="hl kwd">element_blank</span><span class="hl std">(),</span>
    <span class="hl kwc">panel.border</span> <span class="hl std">=</span> <span class="hl kwd">element_rect</span><span class="hl std">(</span><span class="hl kwc">colour</span> <span class="hl std">=</span> <span class="hl str">&quot;gray&quot;</span><span class="hl std">,</span> <span class="hl kwc">fill</span><span class="hl std">=</span><span class="hl num">NA</span><span class="hl std">,</span> <span class="hl kwc">size</span><span class="hl std">=</span><span class="hl num">0.5</span><span class="hl std">)</span>
  <span class="hl std">)</span>
  <span class="hl std">map</span> <span class="hl opt">+</span>
    <span class="hl kwd">geom_polygon</span><span class="hl std">(</span><span class="hl kwd">aes</span><span class="hl std">(</span><span class="hl kwc">fill</span> <span class="hl std">= Cases),</span> <span class="hl kwc">color</span> <span class="hl std">=</span> <span class="hl str">'gray'</span><span class="hl std">,</span> <span class="hl kwc">size</span> <span class="hl std">=</span> <span class="hl num">0.1</span><span class="hl std">)</span> <span class="hl opt">+</span>
    <span class="hl kwd">guides</span><span class="hl std">(</span><span class="hl kwc">fill</span><span class="hl std">=</span><span class="hl kwd">guide_colorbar</span><span class="hl std">(</span><span class="hl kwc">title</span><span class="hl std">=</span><span class="hl str">&quot;HP Index&quot;</span><span class="hl std">))</span> <span class="hl opt">+</span>
    <span class="hl kwd">scale_fill_gradient</span><span class="hl std">(</span><span class="hl kwc">high</span> <span class="hl std">=</span> <span class="hl str">&quot;#e34a33&quot;</span><span class="hl std">,</span> <span class="hl kwc">low</span> <span class="hl std">=</span> <span class="hl str">&quot;#fee8c8&quot;</span><span class="hl std">,</span> <span class="hl kwc">guide</span> <span class="hl std">=</span> <span class="hl str">&quot;colorbar&quot;</span><span class="hl std">)</span> <span class="hl opt">+</span>
    <span class="hl kwd">coord_fixed</span><span class="hl std">(</span><span class="hl num">1.3</span><span class="hl std">)</span> <span class="hl opt">+</span>
    <span class="hl kwd">theme</span><span class="hl std">(</span><span class="hl kwc">legend.justification</span><span class="hl std">=</span><span class="hl kwd">c</span><span class="hl std">(</span><span class="hl num">0</span><span class="hl std">,</span><span class="hl num">0</span><span class="hl std">),</span> <span class="hl kwc">legend.position</span><span class="hl std">=</span><span class="hl kwd">c</span><span class="hl std">(</span><span class="hl num">0</span><span class="hl std">,</span><span class="hl num">0</span><span class="hl std">))</span> <span class="hl opt">+</span>
    <span class="hl std">theme_bare</span>
</pre></div>
<div class="error"><pre class="knitr r">## Error in eval(expr, envir, enclos): object 'map' not found
</pre></div>
<div class="source"><pre class="knitr r">  <span class="hl com"># Adding labels for each district polygon</span>
  <span class="hl com">#Now we need to show districts names in the map. Centroids calculation is bit tricky, but it works if you follow this code from stackoverflow.</span>

  <span class="hl std">centroids</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">setNames</span><span class="hl std">(</span><span class="hl kwd">do.call</span><span class="hl std">(</span><span class="hl str">&quot;rbind.data.frame&quot;</span><span class="hl std">,</span> <span class="hl kwd">by</span><span class="hl std">(nepal.adm3.shp.df, nepal.adm3.shp.df</span><span class="hl opt">$</span><span class="hl std">group,</span> <span class="hl kwa">function</span><span class="hl std">(</span><span class="hl kwc">x</span><span class="hl std">) {</span><span class="hl kwd">Polygon</span><span class="hl std">(x[</span><span class="hl kwd">c</span><span class="hl std">(</span><span class="hl str">'long'</span><span class="hl std">,</span> <span class="hl str">'lat'</span><span class="hl std">)])</span><span class="hl opt">@</span><span class="hl kwc">labpt</span><span class="hl std">})),</span> <span class="hl kwd">c</span><span class="hl std">(</span><span class="hl str">'long'</span><span class="hl std">,</span> <span class="hl str">'lat'</span><span class="hl std">))</span>
</pre></div>
<div class="error"><pre class="knitr r">## Error in by(nepal.adm3.shp.df, nepal.adm3.shp.df$group, function(x) {: object 'nepal.adm3.shp.df' not found
</pre></div>
<div class="source"><pre class="knitr r">  <span class="hl std">centroids</span><span class="hl opt">$</span><span class="hl std">label</span> <span class="hl kwb">&lt;-</span> <span class="hl std">nepal.adm3.shp.df</span><span class="hl opt">$</span><span class="hl std">id[</span><span class="hl kwd">match</span><span class="hl std">(</span><span class="hl kwd">rownames</span><span class="hl std">(centroids), nepal.adm3.shp.df</span><span class="hl opt">$</span><span class="hl std">group)]</span>
</pre></div>
<div class="error"><pre class="knitr r">## Error in eval(expr, envir, enclos): object 'nepal.adm3.shp.df' not found
</pre></div>
<div class="source"><pre class="knitr r">  <span class="hl std">map</span> <span class="hl opt">+</span>
    <span class="hl kwd">geom_polygon</span><span class="hl std">(</span><span class="hl kwd">aes</span><span class="hl std">(</span><span class="hl kwc">fill</span> <span class="hl std">= Cases),</span> <span class="hl kwc">color</span> <span class="hl std">=</span> <span class="hl str">'gray'</span><span class="hl std">,</span> <span class="hl kwc">size</span> <span class="hl std">=</span> <span class="hl num">0.1</span><span class="hl std">)</span> <span class="hl opt">+</span>
    <span class="hl kwd">guides</span><span class="hl std">(</span><span class="hl kwc">fill</span><span class="hl std">=</span><span class="hl kwd">guide_colorbar</span><span class="hl std">(</span><span class="hl kwc">title</span><span class="hl std">=</span><span class="hl str">&quot;Total Covid-19 cases&quot;</span><span class="hl std">))</span> <span class="hl opt">+</span>
    <span class="hl kwd">scale_fill_gradient</span><span class="hl std">(</span><span class="hl kwc">high</span> <span class="hl std">=</span> <span class="hl str">&quot;#e34a33&quot;</span><span class="hl std">,</span> <span class="hl kwc">low</span> <span class="hl std">=</span> <span class="hl str">&quot;#fee8c8&quot;</span><span class="hl std">,</span> <span class="hl kwc">guide</span> <span class="hl std">=</span> <span class="hl str">&quot;colorbar&quot;</span><span class="hl std">)</span> <span class="hl opt">+</span>
    <span class="hl kwd">coord_fixed</span><span class="hl std">(</span><span class="hl num">1.3</span><span class="hl std">)</span> <span class="hl opt">+</span>
    <span class="hl kwd">theme</span><span class="hl std">(</span><span class="hl kwc">legend.justification</span><span class="hl std">=</span><span class="hl kwd">c</span><span class="hl std">(</span><span class="hl num">0</span><span class="hl std">,</span><span class="hl num">0</span><span class="hl std">),</span> <span class="hl kwc">legend.position</span><span class="hl std">=</span><span class="hl kwd">c</span><span class="hl std">(</span><span class="hl num">0</span><span class="hl std">,</span><span class="hl num">0</span><span class="hl std">))</span> <span class="hl opt">+</span>
    <span class="hl kwd">with</span><span class="hl std">(centroids,</span> <span class="hl kwd">annotate</span><span class="hl std">(</span><span class="hl kwc">geom</span><span class="hl std">=</span><span class="hl str">&quot;text&quot;</span><span class="hl std">,</span> <span class="hl kwc">x</span> <span class="hl std">= long,</span> <span class="hl kwc">y</span> <span class="hl std">= lat,</span> <span class="hl kwc">label</span><span class="hl std">=label,</span> <span class="hl kwc">size</span><span class="hl std">=</span><span class="hl num">2</span><span class="hl std">))</span> <span class="hl opt">+</span>
    <span class="hl std">theme_bare</span>
</pre></div>
<div class="error"><pre class="knitr r">## Error in eval(expr, envir, enclos): object 'map' not found
</pre></div>
<div class="source"><pre class="knitr r">  <span class="hl com">#Showing labels for selected districts only</span>
  <span class="hl com">#The map looks cluttered. I am interested in districts which passes certain criteria. Lets show the names for districts for which HPI is greater than 40.</span>

  <span class="hl std">centroids.selected</span> <span class="hl kwb">&lt;-</span> <span class="hl std">centroids[centroids</span><span class="hl opt">$</span><span class="hl std">label</span> <span class="hl opt">%in%</span> <span class="hl std">(nepal.adm3.shp.df[nepal.adm3.shp.df</span><span class="hl opt">$</span><span class="hl std">long</span><span class="hl opt">&gt;</span><span class="hl num">1</span><span class="hl std">,]</span><span class="hl opt">$</span><span class="hl std">id),]</span>
</pre></div>
<div class="error"><pre class="knitr r">## Error in eval(expr, envir, enclos): object 'centroids' not found
</pre></div>
<div class="source"><pre class="knitr r">  <span class="hl std">map</span> <span class="hl opt">+</span>
    <span class="hl kwd">geom_polygon</span><span class="hl std">(</span><span class="hl kwd">aes</span><span class="hl std">(</span><span class="hl kwc">fill</span> <span class="hl std">= Cases),</span> <span class="hl kwc">color</span> <span class="hl std">=</span> <span class="hl str">'gray'</span><span class="hl std">,</span> <span class="hl kwc">size</span> <span class="hl std">=</span> <span class="hl num">0.1</span><span class="hl std">)</span> <span class="hl opt">+</span>
    <span class="hl kwd">guides</span><span class="hl std">(</span><span class="hl kwc">fill</span><span class="hl std">=</span><span class="hl kwd">guide_colorbar</span><span class="hl std">(</span><span class="hl kwc">title</span><span class="hl std">=</span><span class="hl str">&quot;Total Covid-19 cases&quot;</span><span class="hl std">))</span> <span class="hl opt">+</span>
    <span class="hl kwd">scale_fill_gradient</span><span class="hl std">(</span><span class="hl kwc">high</span> <span class="hl std">=</span> <span class="hl str">&quot;#e34a33&quot;</span><span class="hl std">,</span> <span class="hl kwc">low</span> <span class="hl std">=</span> <span class="hl str">&quot;#fee8c8&quot;</span><span class="hl std">,</span> <span class="hl kwc">guide</span> <span class="hl std">=</span> <span class="hl str">&quot;colorbar&quot;</span><span class="hl std">)</span> <span class="hl opt">+</span>
    <span class="hl kwd">coord_fixed</span><span class="hl std">(</span><span class="hl num">1.3</span><span class="hl std">)</span> <span class="hl opt">+</span>
    <span class="hl kwd">theme</span><span class="hl std">(</span><span class="hl kwc">legend.justification</span><span class="hl std">=</span><span class="hl kwd">c</span><span class="hl std">(</span><span class="hl num">0</span><span class="hl std">,</span><span class="hl num">0</span><span class="hl std">),</span> <span class="hl kwc">legend.position</span><span class="hl std">=</span><span class="hl kwd">c</span><span class="hl std">(</span><span class="hl num">0</span><span class="hl std">,</span><span class="hl num">0</span><span class="hl std">))</span> <span class="hl opt">+</span>
    <span class="hl kwd">with</span><span class="hl std">(centroids.selected,</span> <span class="hl kwd">annotate</span><span class="hl std">(</span><span class="hl kwc">geom</span><span class="hl std">=</span><span class="hl str">&quot;text&quot;</span><span class="hl std">,</span> <span class="hl kwc">x</span> <span class="hl std">= long,</span> <span class="hl kwc">y</span> <span class="hl std">= lat,</span> <span class="hl kwc">label</span><span class="hl std">=label,</span> <span class="hl kwc">size</span><span class="hl std">=</span><span class="hl num">2</span><span class="hl std">))</span> <span class="hl opt">+</span>
    <span class="hl std">theme_bare</span>
</pre></div>
<div class="error"><pre class="knitr r">## Error in eval(expr, envir, enclos): object 'map' not found
</pre></div>
<div class="source"><pre class="knitr r">  <span class="hl com"># Adding title to the map</span>
  <span class="hl com">#This is the easiest of all. ggtitle(..) does the job.</span>

  <span class="hl std">map</span> <span class="hl opt">+</span>
    <span class="hl kwd">geom_polygon</span><span class="hl std">(</span><span class="hl kwd">aes</span><span class="hl std">(</span><span class="hl kwc">fill</span> <span class="hl std">= Cases),</span> <span class="hl kwc">color</span> <span class="hl std">=</span> <span class="hl str">'gray'</span><span class="hl std">,</span> <span class="hl kwc">size</span> <span class="hl std">=</span> <span class="hl num">0.1</span><span class="hl std">)</span> <span class="hl opt">+</span>
    <span class="hl kwd">ggtitle</span><span class="hl std">(</span><span class="hl str">&quot;Covid-19 cases Nepal&quot;</span><span class="hl std">)</span> <span class="hl opt">+</span>
    <span class="hl kwd">guides</span><span class="hl std">(</span><span class="hl kwc">fill</span><span class="hl std">=</span><span class="hl kwd">guide_colorbar</span><span class="hl std">(</span><span class="hl kwc">title</span><span class="hl std">=</span><span class="hl str">&quot;Total Covid-19 cases&quot;</span><span class="hl std">))</span> <span class="hl opt">+</span>
    <span class="hl kwd">scale_fill_gradient</span><span class="hl std">(</span><span class="hl kwc">high</span> <span class="hl std">=</span> <span class="hl str">&quot;#e34a33&quot;</span><span class="hl std">,</span> <span class="hl kwc">low</span> <span class="hl std">=</span> <span class="hl str">&quot;#fee8c8&quot;</span><span class="hl std">,</span> <span class="hl kwc">guide</span> <span class="hl std">=</span> <span class="hl str">&quot;colorbar&quot;</span><span class="hl std">)</span> <span class="hl opt">+</span>
    <span class="hl kwd">coord_fixed</span><span class="hl std">(</span><span class="hl num">1.3</span><span class="hl std">)</span> <span class="hl opt">+</span>
    <span class="hl kwd">theme</span><span class="hl std">(</span><span class="hl kwc">legend.justification</span><span class="hl std">=</span><span class="hl kwd">c</span><span class="hl std">(</span><span class="hl num">0</span><span class="hl std">,</span><span class="hl num">0</span><span class="hl std">),</span> <span class="hl kwc">legend.position</span><span class="hl std">=</span><span class="hl kwd">c</span><span class="hl std">(</span><span class="hl opt">-</span><span class="hl num">0.01</span><span class="hl std">,</span><span class="hl num">0</span><span class="hl std">))</span> <span class="hl opt">+</span>
    <span class="hl kwd">with</span><span class="hl std">(centroids.selected,</span> <span class="hl kwd">annotate</span><span class="hl std">(</span><span class="hl kwc">geom</span><span class="hl std">=</span><span class="hl str">&quot;text&quot;</span><span class="hl std">,</span> <span class="hl kwc">x</span> <span class="hl std">= long,</span> <span class="hl kwc">y</span> <span class="hl std">= lat,</span> <span class="hl kwc">label</span><span class="hl std">=label,</span> <span class="hl kwc">size</span><span class="hl std">=</span><span class="hl num">2</span><span class="hl std">))</span> <span class="hl opt">+</span>
    <span class="hl std">theme_bare</span>
</pre></div>
<div class="error"><pre class="knitr r">## Error in eval(expr, envir, enclos): object 'map' not found
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl kwd">summary</span><span class="hl std">(cars)</span>
</pre></div>
<div class="output"><pre class="knitr r">##      speed           dist       
##  Min.   : 4.0   Min.   :  2.00  
##  1st Qu.:12.0   1st Qu.: 26.00  
##  Median :15.0   Median : 36.00  
##  Mean   :15.4   Mean   : 42.98  
##  3rd Qu.:19.0   3rd Qu.: 56.00  
##  Max.   :25.0   Max.   :120.00
</pre></div>
</div></div>

<p>You can also embed plots, for example:</p>

<div class="chunk" id="unnamed-chunk-2"><div class="rcode"><div class="source"><pre class="knitr r"><span class="hl kwd">plot</span><span class="hl std">(cars)</span>
</pre></div>
</div><div class="rimage default"><img src="figure/unnamed-chunk-2-1.png" title="plot of chunk unnamed-chunk-2" alt="plot of chunk unnamed-chunk-2" class="plot" /></div></div>

</body>
</html>
